#!/usr/bin/env ansible-playbook
---
- name: Configure webserver with nginx
  hosts: localhost
  become: True
  tasks:
          - name: install nginx
            apt: name=nginx state=latest update_cache=yes

          - name: copy nginx config file
            copy: src=files/nginx.conf dest=/etc/nginx/nginx.conf
          
          - name: copy nginx default file
            copy: src=files/default dest=/etc/nginx/sites-available/default

          - name: copy index.html
            template: src=templates/index.html.j2 dest=/var/www/html/index.html mode=0644

          - name: restart nginx
            service: name=nginx state=restarted

- name: Install and configure Docker
  hosts: localhost
  become: True
  tasks:
          - name: install required system packages
            apt: name={{item}} state=latest update_cache=yes
            with_items:
                    - apt-transport-https
                    - ca-certificates
                    - curl
                    - gnupg-agent
                    - software-properties-common
          - name: add Docker gpg apt Key
            apt_key:
                    url: https://download.docker.com/linux/ubuntu/gpg
                    state: present
          - name: add Docker repository
            apt_repository:
                    repo: "deb https://download.docker.com/linux/ubuntu bionic stable"
                    state: present
          - name: update apt and install docker-ce
            apt: name=docker-ce state=latest update_cache=yes
